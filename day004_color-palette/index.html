<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>カラーパレット生成 | tiny-tools Day 4</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Hiragino Sans', 'Noto Sans JP', sans-serif;
      background: #f5f5f5;
      color: #333;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 0;
    }

    .container {
      width: 100%;
      max-width: 720px;
      padding: 0 1rem;
      margin-top: 1.5rem;
      padding-bottom: 2rem;
    }

    .picker-card {
      background: #fff;
      border-radius: 8px;
      padding: 1.25rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .picker-card label {
      font-size: 0.875rem;
      font-weight: 600;
      color: #555;
    }

    input[type="color"] {
      width: 48px;
      height: 48px;
      border: 2px solid #ddd;
      border-radius: 8px;
      cursor: pointer;
      padding: 2px;
      background: none;
    }

    input[type="color"]::-webkit-color-swatch-wrapper {
      padding: 0;
    }

    input[type="color"]::-webkit-color-swatch {
      border: none;
      border-radius: 5px;
    }

    .hex-input {
      width: 100px;
      padding: 0.5rem 0.6rem;
      font-size: 0.95rem;
      font-family: 'SF Mono', 'Fira Code', monospace;
      border: 2px solid #ddd;
      border-radius: 6px;
      text-transform: uppercase;
      transition: border-color 0.2s;
    }

    .hex-input:focus {
      outline: none;
      border-color: #4a90d9;
    }

    .btn {
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-family: inherit;
      font-weight: 500;
      transition: background-color 0.2s, transform 0.1s;
    }

    .btn:active {
      transform: scale(0.97);
    }

    .btn-random {
      background: #4a90d9;
      color: #fff;
      margin-left: auto;
    }

    .btn-random:hover {
      background: #357abd;
    }

    .palette-section {
      background: #fff;
      border-radius: 8px;
      padding: 1.25rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
      margin-top: 0.75rem;
    }

    .usage-hint {
      font-size: 0.78rem;
      color: #999;
      text-align: center;
      margin-top: 0.6rem;
      line-height: 1.7;
    }

    .usage-hint span {
      display: inline-block;
      background: #f0f0f0;
      border-radius: 4px;
      padding: 0.1rem 0.45rem;
      color: #666;
      font-size: 0.72rem;
    }

    .palette-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
    }

    .palette-title {
      font-size: 0.85rem;
      font-weight: 600;
      color: #555;
    }

    .btn-info {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      border: 1.5px solid #bbb;
      background: none;
      color: #888;
      font-size: 0.75rem;
      font-weight: 700;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: background 0.15s, color 0.15s, border-color 0.15s;
      flex-shrink: 0;
      padding: 0;
      line-height: 1;
    }

    .btn-info:hover {
      background: #4a90d9;
      color: #fff;
      border-color: #4a90d9;
    }

    .btn-info.active {
      background: #4a90d9;
      color: #fff;
      border-color: #4a90d9;
    }

    .palette-desc {
      overflow: hidden;
      max-height: 0;
      opacity: 0;
      transition: max-height 0.3s ease, opacity 0.3s ease, margin 0.3s ease;
      margin-bottom: 0;
    }

    .palette-desc.open {
      max-height: 200px;
      opacity: 1;
      margin-bottom: 0.75rem;
    }

    .palette-desc-inner {
      font-size: 0.8rem;
      color: #666;
      line-height: 1.6;
      background: #f8f9fa;
      border-radius: 6px;
      padding: 0.75rem 1rem;
    }

    .palette-desc-inner strong {
      color: #444;
    }

    .swatches {
      display: flex;
      gap: 0.5rem;
    }

    .swatch {
      flex: 1 1 60px;
      aspect-ratio: 1 / 1.2;
      border-radius: 8px;
      display: flex;
      align-items: flex-end;
      justify-content: center;
      padding-bottom: 0.5rem;
      cursor: pointer;
      color: #fff;
      font-size: 0.7rem;
      font-family: 'SF Mono', 'Fira Code', monospace;
      font-weight: 500;
      transition: transform 0.15s, box-shadow 0.15s;
      border: 1px solid rgba(0, 0, 0, 0.06);
      user-select: none;
    }

    .swatch:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .swatch.is-light {
      color: #333;
    }

    .export-card {
      background: #fff;
      border-radius: 8px;
      padding: 1.25rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
      margin-top: 0.75rem;
      display: flex;
      gap: 0.75rem;
    }

    .btn-export {
      flex: 1;
      background: #f0f0f0;
      color: #333;
      padding: 0.6rem 1rem;
      font-size: 0.85rem;
    }

    .btn-export:hover {
      background: #e0e0e0;
    }

    .toast {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%) translateY(1rem);
      background: #333;
      color: #fff;
      padding: 0.6rem 1.25rem;
      border-radius: 6px;
      font-size: 0.875rem;
      opacity: 0;
      transition: opacity 0.3s, transform 0.3s;
      pointer-events: none;
      z-index: 200;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    @media (max-width: 480px) {
      .picker-card {
        justify-content: center;
      }

      .btn-random {
        margin-left: 0;
        width: 100%;
      }

      .export-card {
        flex-direction: column;
      }

      .swatch {
        font-size: 0.6rem;
        padding-bottom: 0.3rem;
      }
    }
  </style>
  <script src="../shared/header.js" data-repo="https://github.com/sanasuke/tiny-tools"></script>
</head>
<body>
  <div class="container">
    <div class="picker-card">
      <label for="colorPicker">ベースカラー</label>
      <input type="color" id="colorPicker" value="#4a90d9">
      <input type="text" class="hex-input" id="hexInput" value="#4A90D9" maxlength="7">
      <button class="btn btn-random" id="randomBtn">ランダム</button>
    </div>

    <p class="usage-hint">
      <span>色を選択</span> パレットが自動生成 ／ <span>カラーパネルをクリック</span> hex値をコピー ／ <span>?</span> 配色の解説を表示
    </p>

    <div id="palettesArea"></div>

    <div class="export-card">
      <button class="btn btn-export" id="exportCssBtn">CSS変数をコピー</button>
      <button class="btn btn-export" id="exportTwBtn">Tailwind設定をコピー</button>
    </div>
  </div>
  <div class="toast" id="toast"></div>

  <script>
    /* ===== 1. COLOR MATH ===== */

    function hexToHsl(hex) {
      const r = parseInt(hex.slice(1, 3), 16) / 255;
      const g = parseInt(hex.slice(3, 5), 16) / 255;
      const b = parseInt(hex.slice(5, 7), 16) / 255;

      const max = Math.max(r, g, b);
      const min = Math.min(r, g, b);
      const l = (max + min) / 2;
      let h = 0, s = 0;

      if (max !== min) {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch (max) {
          case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
          case g: h = ((b - r) / d + 2) / 6; break;
          case b: h = ((r - g) / d + 4) / 6; break;
        }
      }

      return { h: h * 360, s: s * 100, l: l * 100 };
    }

    function hslToHex(h, s, l) {
      h = ((h % 360) + 360) % 360;
      s = Math.max(0, Math.min(100, s));
      l = Math.max(0, Math.min(100, l));

      const sN = s / 100;
      const lN = l / 100;
      const c = (1 - Math.abs(2 * lN - 1)) * sN;
      const x = c * (1 - Math.abs((h / 60) % 2 - 1));
      const m = lN - c / 2;
      let r = 0, g = 0, b = 0;

      if (h < 60)      { r = c; g = x; }
      else if (h < 120) { r = x; g = c; }
      else if (h < 180) { g = c; b = x; }
      else if (h < 240) { g = x; b = c; }
      else if (h < 300) { r = x; b = c; }
      else              { r = c; b = x; }

      const toHex = v => Math.round((v + m) * 255).toString(16).padStart(2, '0');
      return `#${toHex(r)}${toHex(g)}${toHex(b)}`.toUpperCase();
    }

    function isLight(hex) {
      const r = parseInt(hex.slice(1, 3), 16);
      const g = parseInt(hex.slice(3, 5), 16);
      const b = parseInt(hex.slice(5, 7), 16);
      const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
      return luminance > 0.6;
    }

    /* ===== 2. HARMONY GENERATORS ===== */

    function complementary(hex) {
      const { h, s, l } = hexToHsl(hex);
      return [
        { hex: hex, label: 'Base' },
        { hex: hslToHex(h + 180, s, l), label: 'Complement' },
      ];
    }

    function analogous(hex) {
      const { h, s, l } = hexToHsl(hex);
      return [
        { hex: hslToHex(h - 30, s, l), label: '-30°' },
        { hex: hslToHex(h - 15, s, l), label: '-15°' },
        { hex: hex, label: 'Base' },
        { hex: hslToHex(h + 15, s, l), label: '+15°' },
        { hex: hslToHex(h + 30, s, l), label: '+30°' },
      ];
    }

    function triadic(hex) {
      const { h, s, l } = hexToHsl(hex);
      return [
        { hex: hex, label: 'Base' },
        { hex: hslToHex(h + 120, s, l), label: '+120°' },
        { hex: hslToHex(h + 240, s, l), label: '+240°' },
      ];
    }

    function splitComplementary(hex) {
      const { h, s, l } = hexToHsl(hex);
      return [
        { hex: hex, label: 'Base' },
        { hex: hslToHex(h + 150, s, l), label: '+150°' },
        { hex: hslToHex(h + 210, s, l), label: '+210°' },
      ];
    }

    function monochromatic(hex) {
      const { h, s, l } = hexToHsl(hex);
      return [
        { hex: hslToHex(h, s, Math.max(l - 30, 5)), label: 'Darkest' },
        { hex: hslToHex(h, s, Math.max(l - 15, 10)), label: 'Dark' },
        { hex: hex, label: 'Base' },
        { hex: hslToHex(h, s, Math.min(l + 15, 90)), label: 'Light' },
        { hex: hslToHex(h, s, Math.min(l + 30, 95)), label: 'Lightest' },
      ];
    }

    const HARMONIES = [
      {
        name: '補色 (Complementary)', fn: complementary,
        desc: '<strong>色相環で正反対（180°）の2色</strong>の組み合わせ。互いの色を最も引き立て合い、強いコントラストを生みます。CTA ボタンやアクセントカラーに効果的。使いすぎると目がチカチカするので、片方をメイン・もう片方をアクセントに絞るのがコツです。',
      },
      {
        name: '類似色 (Analogous)', fn: analogous,
        desc: '<strong>色相環で隣り合う色（±15°〜30°）</strong>を集めた配色。自然界によく見られ、調和がとれた落ち着いた印象を与えます。背景・カード・セクション分けなど、統一感のあるUIデザインに最適です。',
      },
      {
        name: 'トライアディック (Triadic)', fn: triadic,
        desc: '<strong>色相環を3等分（120°間隔）</strong>した3色の配色。バランスが良く、補色ほど激しくないのに十分な多様性があります。メイン1色＋サブ2色の割合で使うと、にぎやかだけどまとまりのあるデザインになります。',
      },
      {
        name: '分裂補色 (Split-Complementary)', fn: splitComplementary,
        desc: '<strong>補色の両隣（±30°）</strong>を使う配色。補色配色のコントラストを残しつつ、やや柔らかい印象になります。初心者でも失敗しにくく、Webデザインで使い勝手の良いパターンです。',
      },
      {
        name: 'モノクロマティック (Monochromatic)', fn: monochromatic,
        desc: '<strong>同じ色相で明度だけを変えた</strong>配色。シンプルで洗練された印象を与え、ブランディングやダッシュボードUIに最適。色の統一感が強いため、情報の階層を明度の差で表現できます。',
      },
    ];

    /* ===== 3. RENDERING ===== */

    const palettesArea = document.getElementById('palettesArea');

    function createSwatchEl(color) {
      const el = document.createElement('div');
      el.className = 'swatch' + (isLight(color.hex) ? ' is-light' : '');
      el.style.backgroundColor = color.hex;
      el.textContent = color.hex;
      el.title = `${color.label}: ${color.hex} — クリックでコピー`;
      el.addEventListener('click', () => copyToClipboard(color.hex));
      return el;
    }

    function renderPalettes(baseHex) {
      palettesArea.innerHTML = '';
      HARMONIES.forEach(harmony => {
        const section = document.createElement('div');
        section.className = 'palette-section';

        const header = document.createElement('div');
        header.className = 'palette-header';

        const title = document.createElement('div');
        title.className = 'palette-title';
        title.textContent = harmony.name;
        header.appendChild(title);

        const infoBtn = document.createElement('button');
        infoBtn.className = 'btn-info';
        infoBtn.textContent = '?';
        infoBtn.title = '配色パターンの説明を表示';
        header.appendChild(infoBtn);

        section.appendChild(header);

        const desc = document.createElement('div');
        desc.className = 'palette-desc';
        desc.innerHTML = `<div class="palette-desc-inner">${harmony.desc}</div>`;
        section.appendChild(desc);

        infoBtn.addEventListener('click', () => {
          const isOpen = desc.classList.toggle('open');
          infoBtn.classList.toggle('active', isOpen);
        });

        const swatches = document.createElement('div');
        swatches.className = 'swatches';
        harmony.fn(baseHex).forEach(color => {
          swatches.appendChild(createSwatchEl(color));
        });
        section.appendChild(swatches);

        palettesArea.appendChild(section);
      });
    }

    /* ===== 4. EXPORT ===== */

    function buildCssVariables(baseHex) {
      const lines = ['/* カラーパレット CSS変数 */\n:root {'];
      HARMONIES.forEach(harmony => {
        const slug = harmony.name.split(' (')[1].replace(')', '').toLowerCase();
        harmony.fn(baseHex).forEach((color, i) => {
          lines.push(`  --${slug}-${i + 1}: ${color.hex};`);
        });
      });
      lines.push('}');
      return lines.join('\n');
    }

    function buildTailwindConfig(baseHex) {
      const colors = {};
      HARMONIES.forEach(harmony => {
        const slug = harmony.name.split(' (')[1].replace(')', '').toLowerCase();
        colors[slug] = {};
        harmony.fn(baseHex).forEach((color, i) => {
          colors[slug][(i + 1) * 100] = color.hex;
        });
      });
      return `// tailwind.config.js\nmodule.exports = {\n  theme: {\n    extend: {\n      colors: ${JSON.stringify(colors, null, 8).replace(/^/gm, '      ').trimStart()}\n    }\n  }\n}`;
    }

    /* ===== 5. EVENT HANDLERS + INIT ===== */

    const colorPicker = document.getElementById('colorPicker');
    const hexInput = document.getElementById('hexInput');
    const randomBtn = document.getElementById('randomBtn');
    const exportCssBtn = document.getElementById('exportCssBtn');
    const exportTwBtn = document.getElementById('exportTwBtn');
    const toast = document.getElementById('toast');

    function showToast(message) {
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 1500);
    }

    async function copyToClipboard(text) {
      try {
        await navigator.clipboard.writeText(text);
        showToast(`${text} をコピーしました`);
      } catch {
        showToast('コピーに失敗しました');
      }
    }

    function setColor(hex) {
      colorPicker.value = hex.toLowerCase();
      hexInput.value = hex.toUpperCase();
      renderPalettes(hex);
    }

    colorPicker.addEventListener('input', () => {
      setColor(colorPicker.value);
    });

    hexInput.addEventListener('input', () => {
      let val = hexInput.value.trim();
      if (!val.startsWith('#')) val = '#' + val;
      if (/^#[0-9A-Fa-f]{6}$/.test(val)) {
        setColor(val);
      }
    });

    randomBtn.addEventListener('click', () => {
      const hex = '#' + Math.floor(Math.random() * 0xFFFFFF).toString(16).padStart(6, '0');
      setColor(hex);
    });

    exportCssBtn.addEventListener('click', () => {
      copyToClipboard(buildCssVariables(colorPicker.value));
    });

    exportTwBtn.addEventListener('click', () => {
      copyToClipboard(buildTailwindConfig(colorPicker.value));
    });

    // Init
    setColor('#4A90D9');
  </script>
</body>
</html>
